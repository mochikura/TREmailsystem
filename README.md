# 大まかな説明  
Chrome拡張としてファイルごと追加すると拡張機能として使えます  
メール送信時はIDベース署名を送信時に追加、ファイル暗号化ができる部分を追加  
メール受信時にはIDベース署名を検証できる場所、ファイルの復号ができる部分を追加 

ファイル暗号化には二種類ある
#### IBE
ID Based Encryption、IDベース暗号  
IDという個人を識別できる文字列を用いて暗号化する  
ID自体の認証・登録が事前に必要  
#### TRE
Time Release Encryption、タイムリリース暗号  
時間を用いて暗号化することで、復号時刻を指定可能  
時間で暗号化するので、認証等が不要  

# 使用方法
## 必須環境(動作環境)
Google Chrome (Chromeに準ずるウェブブラウザでも可、例：Iron)

## 導入方法
Google Chromeの設定  
→拡張機能  
→デベロッパーモードをON  
→パッケージ化されていない拡張機能を読み込む  
→このTREmailsystemのフォルダを選択する  
→追加された拡張「mail encryption system」をON（有効）にする  

## 動作仕様
#### IDベース暗号でのユーザ登録
未実装  

#### 送信側署名生成
学内メールシステムのメール送信ページを開く  
→送信者の行にパスワードを記入する場所があるので、予め設定したパスワードを記入  
→サインインを押す  
→成功したらメール送信ボタンの場所に「ID署名付きで送信」が追加される。  
→ボタンを押すと、署名が付加されて送信される  

#### 送信側IBEファイル暗号化
学内メールシステムのメール送信ページを開く  
→「選択してください」から「IDベース暗号」を選択  
→予め登録していたID(email)とパスワードを入力  
→暗号化したいファイルを選択  
→「サインイン&暗号化」を押す  
→サインインが成功されると、暗号化されたファイルがダウンロードされる  
→そのファイルをメールに添付する  

#### 送信側TREファイル暗号化
学内メールシステムのメール送信ページを開く  
→「選択してください」から「タイムリリース暗号」を選択  
→復号を制限したい時刻を選択  
→暗号化したいファイルを選択  
→「暗号化」を押す  
→暗号化されたファイルがダウンロードされる  
→そのファイルをメールに添付する  

#### 受信側署名検証
学内メースシステムのメール受信トレイを開く、検証したいメールを選択する  
→メールの中身が表示されている部分の「IDベース署名検証」というボタンを押す  
→追加された部分に予め登録していたID(email)とパスワードを入力  
→「署名検証&サインイン」を押す  
→署名検証の結果が表示される  

#### 受信側IBEファイル復号
学内メースシステムのメール受信トレイを開く、検証したいファイルが添付されているメールを選択する  
→「ファイル暗号化」の中から「IDベース暗号」を押す  
→追加された部分に予め登録していたID(email)とパスワードを入力  
→復号したいファイルを選択  
→「サインイン&復号」を押す  
→復号されたファイルがダウンロードされる  

#### 受信側TREファイル復号
学内メースシステムのメール受信トレイを開く  
→「ファイル暗号化」の中から「タイムリリース暗号」を押す  
→追加された部分で複合したいファイルを選択  
→「復号」を押す  
→復号時間が有効であれば復号されたファイルがダウンロードされる  


# ファイル説明  
#### axios.js
サーバとの通信に使います  
#### dec.js
受信側の実際な復号処理があります  
#### enc.js
送信側の実際な暗号化処理があります  
#### getkey.js
サーバから暗号化復号につかうデータを受信します  
#### index.js
過去の名残なので無視してもいいですが、一部変数の宣言や日付、JWTの設定などをしています  
#### initdec.js
受信側のメールシステムのレイアウトを設定しています  
#### initenc.js
送信側のメールシステムのレイアウトを設定しています  
#### jquery-3.5.1.js
jQuery系のあれこれを使うにはこれが必要  
#### manifest.json
Chrome拡張に関する設定  
#### mcl.js
mclライブラリです。IDベース暗号・タイムリリース暗号には必須  
#### README.md
これ  
#### js(file)
CrypyoJSっていう暗号化に使えるライブラリを入れてます
